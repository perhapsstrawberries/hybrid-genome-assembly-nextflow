// =========================
// Project 1 â€” nextflow.config
// =========================

params {
  bac_samples = "$projectDir/bac_samples.csv"
  outdir      = "$projectDir/results/"
  ref_genome  = "GCF_000172635.2"
}

conda {
  enabled     = true
  useMamba    = false
  cacheDir    = "$projectDir/.conda_cache"
  createRetry = 3
}

profiles {

  conda {
    conda.enabled = true
  }

  singularity {
    singularity.enabled    = true
    singularity.autoMounts = true
  }

  // ---- SCC cluster profile (SGE) ----
  cluster {
    process {
      executor = 'sge'
      penv     = 'omp'

      // IMPORTANT: use a closure so ${task.cpus} resolves per task
      clusterOptions = { "-P bf528 -pe omp ${task.cpus}" }

      // Default labels
      withLabel: process_single { cpus = 1;  memory = '2 GB'   }
      withLabel: process_low    { cpus = 4;  memory = '6 GB'   }
      withLabel: process_medium { cpus = 8;  memory = '16 GB'  }
      withLabel: process_high   { cpus = 16; memory = '128 GB' }

      // Per-process label mapping
      withName: FASTQC            { label = 'process_low'    }
      withName: FILTLONGER        { label = 'process_low'    }
      withName: FLYE              { label = 'process_high'   }
      withName: BOWTIE2_INDEX     { label = 'process_medium' }
      withName: BOWTIE2_ALIGN     { label = 'process_medium' }
      withName: SAMTOOLS_SORT     { label = 'process_medium' }
      withName: PILON             { label = 'process_high'   }
      withName: NCBI_DATASETS     { label = 'process_low'    }
      withName: PROKKA            { label = 'process_medium' }
      withName: BUSCO             { label = 'process_high'   }
      withName: QUAST             { label = 'process_medium' }
      withName: QUAST_UNPOLISHED  { label = 'process_medium' }
      withName: BUSCO_PLOT        { label = 'process_low'    }
    }
  }

  // ---- Local fallback ----
  local {
    process.executor = 'local'
  }
}

executor {
  $sge   { queueSize = 8 }
  $local { cpus = 1 }
}

resume = true
